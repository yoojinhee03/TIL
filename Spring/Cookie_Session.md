## 쿠키와 세션을 사용하는 이유

HTTP 프로토콜의 특징이자 약점을 보완하기 위해서 사용한다.

### HTTP 프로토콜의 특징

* 비연결성(Connectionless)

  * 클라이언트와 서버가 한 번 연결을 맺은 후, 클 라이언트 요청에 대해 서버가 응답을 마치면 맺었던 연결을 끊는다.

* 무상태(Stateless)

  * 연결을 끊는 순간(Connectionless) 클라이언트와 서버의 통신이 끝나며 상태 정보를 유지하지 않는다.

## 쿠키

### 쿠키(Cookie)

* **클라이언트** 측에 저장되는 **키와 값**이 들어있는 문자열 형태의 작은 데이터 파일이다.
* 사용자 인증이 유효한 시간을 명시할 수 있으며 브라우저를 끄더라도 만료시간이 남아있다면 인증 유지
* 브라우저별로 저장된다.
  * ex) 크롬에서 저장된 쿠키 정보는 크롬에서만 이용가능

### 쿠키 사용 사례

* 자동로그인
* "오늘 더 이상 이 창을 보지 않음" 팝업창
* 쇼핑몰의 장바구니

### 쿠키의 동작 방식

1. 클라이언트가 페이지를 요청
2. 서버에서 쿠키를 생성
3. HTTP 헤더에 쿠키를 포함 시켜 응답
4. 브라우저가 종료되어도 쿠키 만료 기간이 있다면 클라이언트에서 보관하고 있음
5. 쿠키가 존재하면 요청을 할 경우 HTTP 헤더에 쿠키를 함께 보내서 요청
6. 서버에서 쿠키를 읽어 이전 상태 정보를 변경 할 필요가 있을 경우, 쿠키를 업데이트 하여 변경된 쿠키를 HTTP 헤더에 포함시켜 응답

### 쿠키 값 추가하기

```java
//쿠키 값을 저장하는 핸들러
for(String key : params.keySet()) {
        // 문자열 타입의 키, 값을 이용하여 쿠키 정보 생성 (스펙상 문자열 밖에 저장 불가)
        Cookie c = new Cookie(key, params.get(key).toString());
        c.setMaxAge(60);
   	 	c.setPath("/page");
    	/*/page 라는 특정주소로만 해당 쿠키 데이터를 보냄*/
        c.setHttpOnly(true);
        c.setSecure(true);
        response.addCookie(c);
}
```

#### 메소드

* **setMaxAge** 메소드 : 만료시간(초 단위)
  * 만료시간이 끝나면 쿠키 정보 삭제
  * 절대 시간으로 적용
* **setPath** 메소드 : 해당 쿠키 데이터를 보낼 특정 주소(path) 설정
* **setHttpOnly** 메소드 : 자바스크립트를 이용한 쿠키 접근 금지 가능
  * 보안성 향상
* **setSecure** 메소드 : HTTPS 를 통해 통신할 경우에만 쿠키를 전송하도록 허용 가능

#### 응답 헤더

* 개별 쿠키 정보마다 **Set-Cookie** 헤더 추가



### 쿠키 값 가져오기

```java
//쿠키 값을 가져오는 핸들러
@CookieValue(value="data1", defaultValue="Hello") String data1, 
@CookieValue(value="asdf", required=false) String asdf
```

* **@CookieValue 어노테이션 사용**하여 쿠키에 저장된 데이터 가져오기 가능 (value에 적힌 값이 가져올 쿠키의 이름, 기본값, 필수 여부도 지정 가능)

```java
String result = "no cookies";
// 요청 메시지를 통해 받은 모든 쿠키 객체 가져오기
Cookie[] cookies = request.getCookies();
    if(cookies != null) {
    	result = "";
    	for(Cookie c : cookies) {
    	// 쿠키의 이름(=키)와 값 출력
    	result += c.getName() + " : " + c.getValue() + "\n";
    }
}
```

* 요청 객체를 통해 쿠키 데이터 접근 가능
* 



### 쿠키 값 삭제하기

## 세션

### 세션(Session)

* 쿠키를 기반으로 하고 있지만 **서버 **측에 저장된다.
* 클라이언트를 구분하기 위해 세션ID를 부여하며 웹 브라우저가 서버에 접속해서 브라우저를 종료할 때까지 인증상태를 유지(브라우저가 종료되면 만료시간이 남아있더라도 인증상태 만료)

### 세션 사용 사례

* 로그인

### 세션의 동작 방식

1. 클라이언트가 서버에 접속 시 세션 ID를 발급
2. 클라이언트는 세션 ID에 대해 쿠키를 사용해서 저장 ( 이 때 쿠키 이름은 JSESSIONID이다. )
3. 클라이언트가 서버에 다시 접속 시 이 쿠키를 이용해서 세션 ID 값을 서버에 전달



## 쿠키와 세션의 차이점

|          | 쿠키                                                         | 세션                                     |
| -------- | ------------------------------------------------------------ | ---------------------------------------- |
| 저장위치 | 클라이언트                                                   | 서버                                     |
| 보안     | 세션보다 취약                                                | 쿠키보다 좋음                            |
| 만료시점 | 쿠키 저장시 설정<br>(브라우저가 종료되도, 만료시점이 지나지 않으면 자동 삭제되지 않음) | 브라우저 종료시 삭제<br>(기간 지정 가능) |
| 속도     | 세션보다 빠름                                                | 쿠키보다 느림                            |

